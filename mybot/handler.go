package mybot

import (
	"database/sql"
	"log"

	tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

// HandleMessage - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
func HandleMessage(bot *tgbotapi.BotAPI, msg *tgbotapi.Message,
	forwardChatID int64, db *sql.DB, botUsername string) {

	log.Printf("üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç @%s: %s", msg.From.UserName, msg.Text)

	// ===============================================
	// 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞)
	// ===============================================
	if db != nil {
		SaveMessageToDB(db, botUsername, msg)
	}

	// ===============================================
	// 2. –ü–µ—Ä–µ—Å—ã–ª–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
	// ===============================================
	forwardMessage(bot, msg, forwardChatID)

	// ===============================================
	// 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–≥ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —á–∞—Ç
	// ===============================================
	SendMessageLog(bot, msg, botUsername, bot.Self.ID)

	// ===============================================
	// 4. –ö–æ–º–∞–Ω–¥—ã
	// ===============================================
	if msg.IsCommand() {
		handleCommand(bot, msg)
	}

	// ID —á–∞—Ç–∞ –¥–ª—è –ª–æ–≥–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤)
	logChatID := int64(-1003516004835)

	// –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –¢–†–ò–ì–ì–ï–†–û–í:
	// –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–º —Ç—Ä–∏–≥–≥–µ—Ä–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–≤–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è

	// ===============================================
	// 5. –ù–û–í–´–ô –¢–†–ò–ì–ì–ï–†: "–µ–±–∞—Ç—å —É—Ñ—É" –∏–ª–∏ "–µ–±–∞—Ç—å —Å–ø–∞—Ä—Ç–∞–∫" (–ü–ï–†–í–´–ô –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
	// ===============================================
	if CheckEbatTriggers(bot, msg, logChatID) {
		return // –¢—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª, –¥–∞–ª—å—à–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º
	}

	// ===============================================
	// 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã—Ö —Å–ª–æ–≤ "–°–≤–∏–Ω–æ—Å–æ–±–∞–∫–∞" (–≤—Ç–æ—Ä–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
	// ===============================================
	if CheckSvinoSobakaTriggers(bot, msg, logChatID) {
		return // –¢—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª, –¥–∞–ª—å—à–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º
	}

	// ===============================================
	// 7. –¢–†–ò–ì–ì–ï–†: "—Å–ø–∞—Ä—Ç–∞–∫ –∫—É–¥–∞ –¥–µ–Ω–µ–º" (—Ç—Ä–µ—Ç–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
	// ===============================================
	if CheckHuiNadenemTriggers(bot, msg, logChatID) {
		return // –¢—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª, –¥–∞–ª—å—à–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º
	}

	// ===============================================
	// 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã—Ö —Å–ª–æ–≤ "–°–ø–∞—Ä—Ç–∞–∫" (—á–µ—Ç–≤–µ—Ä—Ç—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
	// ===============================================
	if CheckSpartakTriggers(bot, msg, logChatID) {
		return // –¢—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª, –¥–∞–ª—å—à–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º
	}

	// ===============================================
	// 9. –ù–û–í–´–ô –¢–†–ò–ì–ì–ï–†: –ê–ª–∫–æ–≥–æ–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã (–ø—è—Ç—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
	// ===============================================
	if CheckAlcoholTriggers(bot, msg, logChatID) {
		return // –¢—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª
	}
}
